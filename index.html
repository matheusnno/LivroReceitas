<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minhas Receitas</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="topbar">
    <h1>Minhas Receitas</h1>
    <nav class="nav">
      <a href="index.html" class="active">Listar</a>
      <a href="nova.html">Nova Receita</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <div class="card-header">
        <h2>Receitas</h2>
        <div class="actions">
          <input id="busca" type="search" placeholder="Buscar por nome ou ingrediente…" />
          <button id="btnBuscar" class="btn">Buscar</button>
        </div>
      </div>
      <div id="lista" class="grid"></div>
    </section>
  </main>

  <template id="tpl-receita-card">
    <article class="recipe-card">
      <div class="recipe-card-body">
        <h3 class="recipe-title"></h3>
        <p class="recipe-meta"></p>
      </div>
      <div class="recipe-card-actions">
        <a class="btn btn-ghost btn-small ver-receita" href="#">Abrir</a>
        <button class="btn btn-danger btn-small deletar-receita">Excluir</button>
      </div>
    </article>
  </template>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="js/app.js"></script>
  <script>
    // Carregar e renderizar receitas
    async function carregar() {
      const termo = (document.getElementById('busca').value || '').trim();
      const receitas = await api.listarReceitas(termo);
      const lista = document.getElementById('lista');
      lista.innerHTML = '';
      const tpl = document.getElementById('tpl-receita-card');
      if (!receitas.length) {
        lista.innerHTML = '<p class="muted">Nenhuma receita encontrada.</p>';
        return;
      }
      receitas.forEach(r => {
        const node = tpl.content.cloneNode(true);
        node.querySelector('.recipe-title').textContent = r.nome;
        const meta = [];
        if (r.categoria) meta.push(r.categoria);
        if (r.tempo_preparo) meta.push(r.tempo_preparo + ' min');
        if (r.rendimento) meta.push(r.rendimento);
        node.querySelector('.recipe-meta').textContent = meta.join(' • ');

        const link = node.querySelector('.ver-receita');
        link.href = 'receita.html?id=' + encodeURIComponent(r.id);

        const btnDel = node.querySelector('.deletar-receita');
        btnDel.addEventListener('click', async () => {
          if (confirm('Tem certeza que deseja excluir esta receita?')) {
            await api.deletarReceita(r.id);
            await carregar();
          }
        });

        lista.appendChild(node);
      });
    }

    document.getElementById('btnBuscar').addEventListener('click', carregar);
    document.getElementById('busca').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') carregar();
    });

    carregar();
  </script>
</body>
</html>
